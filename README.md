# Thunderbird 誤送信防止アドオン

<div align="center">

![Thunderbird Logo](https://img.shields.io/badge/Thunderbird-78.0+-0078D4?style=for-the-badge&logo=thunderbird&logoColor=white)
![Version](https://img.shields.io/badge/Version-1.1.2-green?style=for-the-badge)
![License](https://img.shields.io/badge/License-MIT-blue?style=for-the-badge)
![Language](https://img.shields.io/badge/Language-Japanese-red?style=for-the-badge)

**TO欄に複数のメールアドレスがある場合の誤送信を防止するThunderbirdアドオン**

[🚀 インストール](#インストール方法) | [📖 使い方](#使い方) | [🐛 バグ報告](https://github.com/akioogawa/thunderbird-misend-prevention/issues) | [💡 機能要求](https://github.com/akioogawa/thunderbird-misend-prevention/issues)

</div>

---

## 📋 目次

- [概要](#概要)
- [主な機能](#主な機能)
- [動作デモ](#動作デモ)
- [インストール方法](#インストール方法)
- [使い方](#使い方)
- [技術仕様](#技術仕様)
- [対応環境](#対応環境)
- [トラブルシューティング](#トラブルシューティング)
- [開発者向け情報](#開発者向け情報)
- [更新履歴](#更新履歴)
- [ライセンス](#ライセンス)
- [作成者情報](#作成者情報)

---

## 🎯 概要

**作成者**: AKIO OGAWA  
**作成日**: 2025年8月23日  
**バージョン**: 1.1.4

このアドオンは、Mozilla Thunderbirdでメール送信時にTO欄に複数のメールアドレスが入力されている場合に誤送信を防止するためのアドオンです。特に一斉メール送信時のプライバシー保護に重点を置いて開発されています。

### ⚠️ なぜ必要か？

- **プライバシー漏洩の防止**: TO欄での一斉送信は、すべての受信者にお互いのメールアドレスが見えてしまいます
- **GDPR・個人情報保護法対応**: 適切なメール送信方法の徹底
- **ビジネスマナー**: 複数の宛先にはBCC欄を使用するのが一般的

## ✨ 主な機能

### 🔍 自動検出機能
- **TO欄・CC欄の複数アドレス検出**: 送信前にTO欄・CC欄に複数のメールアドレスが入力されているかを自動チェック
- **日本語名対応**: "小川明男 <email@example.com>" のような日本語名を含む形式にも対応
- **リアルタイム監視**: 送信ボタンクリック時に即座にチェック

### 🛡️ 誤送信防止機能
- **送信停止機能**: TO欄・CC欄に複数のアドレスが検出された場合、自動的に送信を停止
- **複数の警告表示**: システム通知、アラートダイアログ、コンソール警告で確実に通知
- **強制停止**: エラーが発生しても確実に送信を停止

### 💬 ユーザーフレンドリー
- **分かりやすい警告**: 日本語での詳細なメッセージ表示
- **BCC推奨**: TO欄ではなくBCC欄の使用を推奨するガイダンス
- **非侵入的**: 正常な送信には一切影響しません

## 🎬 動作デモ

### ✅ 正常な送信パターン

| 送信パターン | TO欄 | BCC欄 | 結果 |
|-------------|------|-------|------|
| 単一宛先 | 1件 | - | ✅ 送信許可 |
| BCC一斉送信 | - | 複数件 | ✅ 送信許可 |
| 混合パターン | 1件 | 複数件 | ✅ 送信許可 |

### ⚠️ 警告が表示されるパターン

| 送信パターン | TO欄 | CC欄 | 結果 |
|-------------|------|------|------|
| TO一斉送信 | 2件以上 | - | ❌ 送信停止 + 警告表示 |
| CC一斉送信 | - | 2件以上 | ❌ 送信停止 + 警告表示 |

## 📦 インストール方法

### 🎯 推奨方法: 直接インストール

1. **ZIPファイルをダウンロード**
   ```
   thunderbird_-1.1.2.zip
   ```

2. **Thunderbirdでインストール**
   - Thunderbirdを開く
   - `ツール` → `アドオン` を選択
   - 歯車アイコンをクリック → `ファイルからアドオンをインストール`
   - ダウンロードした`.zip`ファイルを選択

3. **アドオンを有効化**
   - インストール完了後、アドオンを有効化
   - Thunderbirdを再起動

### 🔄 更新方法

1. 既存のアドオンを無効化
2. 新しいバージョンをインストール
3. Thunderbirdを再起動

## 📖 使い方

### 🎯 基本的な使用方法

1. **メール作成**: 通常通りメールを作成
2. **宛先入力**: TO欄にメールアドレスを入力
3. **送信実行**: 送信ボタンをクリック
4. **自動チェック**: アドオンが自動的にTO欄をチェック

### ⚠️ 警告が表示された場合

```
🚨 誤送信防止警告

TO欄（またはCC欄）に複数のメールアドレスが検出されました！
送信が停止されました。

検出されたアドレス:
• email1@example.com
• email2@example.com

BCC欄を使用することを推奨します。
```

**対処方法**:
1. TO欄・CC欄から複数のアドレスを削除
2. BCC欄に複数のアドレスを移動
3. 再度送信を実行

## ⚙️ 技術仕様

### 🔧 アーキテクチャ

- **Background Script**: `background.js` - メイン処理
- **Content Script**: `content.js` - 送信ボタン監視
- **Manifest V2**: Thunderbird対応

### 🌐 WebExtension APIs

- `browser.compose.onBeforeSend`: 送信前イベント（メイン）
- `browser.compose.getComposeDetails`: メール詳細取得
- `browser.notifications.create`: システム通知
- `browser.tabs.executeScript`: アラート表示

### 🔒 権限

```json
{
  "permissions": [
    "compose",      // メール作成機能
    "notifications", // システム通知
    "tabs",         // タブ操作
    "activeTab"     // アクティブタブアクセス
  ]
}
```

## 🖥️ 対応環境

### ✅ 対応バージョン

| ソフトウェア | 最小バージョン | 最大バージョン | 推奨バージョン |
|-------------|---------------|---------------|---------------|
| **Thunderbird** | 78.0 | 150.* | 142.0+ |
| **Windows** | 10 | 11 | 11 |
| **macOS** | 10.14 | 最新 | 最新 |
| **Linux** | Ubuntu 18.04+ | 最新 | 最新 |

### 🧪 テスト済み環境

- ✅ Thunderbird 128.9.1 (Windows 11)
- ✅ Thunderbird 142.0 (Windows 11)
- ✅ 日本語環境
- ✅ 英語環境

## 🔧 トラブルシューティング

### 全環境対応（v1.1.4）

v1.1.4では、Thunderbird 128.9.1を含むすべての環境で確実に動作するよう最適化しました：

- **複数の送信検知方法**: onBeforeSend API + content scriptによる二重監視
- **強制的な送信停止**: エラーが発生しても確実に送信を停止
- **即座の警告表示**: 複数の通知方法で確実に警告を表示
- **初期化保証**: アドオンの初期化を確実に行い、動作を保証

- **システム通知**: JavaScriptに依存しない基本的な通知
- **コンソール警告**: 開発者ツールでの詳細なログ出力
- **アラートダイアログ**: 従来のアラート形式での警告
- **タブタイトル変更**: 視覚的な警告表示

### よくある問題と解決方法

#### ❓ 警告が表示されない

**原因と対策**:
1. **アドオンの有効化確認**
   - `ツール` → `アドオン` でアドオンが有効か確認
   
2. **ログ確認**
   - `F12` → コンソールタブでエラーログを確認
   
3. **Thunderbird再起動**
   - Thunderbirdを完全に再起動

#### ❓ 送信できない

**対処法**:
1. **アドオンを一時的に無効化**
2. **エラーログを確認**
3. **アドオンを再有効化**

#### ❓ 日本語名のメールアドレスで問題

v1.1.2で解決済み：
- "名前 <メールアドレス>" 形式への対応
- 日本語文字を含む名前の正確な解析

### 📊 デバッグ情報

開発者ツール（F12）で以下のログを確認：

```
=== Thunderbird 誤送信防止アドオンが起動しました ===
🔍 アドオン初期化開始...
✅ onBeforeSend API を使用します
✅ onBeforeSend リスナーが正常に登録されました
```

## 👨‍💻 開発者向け情報

### 🛠️ 開発環境セットアップ

```bash
# リポジトリクローン
git clone https://github.com/akioogawa/thunderbird-misend-prevention.git
cd thunderbird-misend-prevention

# 依存関係インストール
npm install

# 開発モード起動
npm run dev

# ビルド
npm run build

# リント
npm run lint
```

### 📁 プロジェクト構成

```
thunderbird-misend-prevention/
├── manifest.json         # アドオン設定
├── background.js         # バックグラウンドスクリプト
├── content.js           # コンテンツスクリプト
├── package.json         # Node.js設定
├── README.md           # このファイル
├── LICENSE.txt         # MITライセンス
├── CHANGELOG.md        # 更新履歴
├── CONTRIBUTING.md     # 開発ガイドライン
└── web-ext-artifacts/  # ビルド成果物
    └── thunderbird_-1.1.2.zip
```

### 🤝 貢献方法

1. **Issue作成**: バグ報告・機能要求
2. **Pull Request**: コード貢献
3. **テスト**: 異なる環境でのテスト協力

詳細は [CONTRIBUTING.md](CONTRIBUTING.md) をご覧ください。

### BCC送信エラーの解決方法

BCC欄のみでメールを送信する際にエラーが発生する場合：

1. **TO欄に自分のアドレスを追加**
   - TO欄: 自分のメールアドレス
   - BCC欄: 送信したい複数のアドレス

2. **SMTPサーバー設定確認**
   - メールプロバイダーの設定を確認
   - 認証情報が正しいか確認

3. **メールアドレスの有効性確認**
   - 送信先アドレスが実在するか確認
   - 無効なアドレスが含まれていないか確認

## 📈 更新履歴

- **v1.1.4** (2025年8月23日): CC欄警告修正版
  - CC欄警告ダイアログの表示問題を修正
  - 重複警告防止機能の改善
  - 詳細ログ機能の追加

- **v1.1.3** (2025年8月23日): CC欄対応版
  - CC欄の複数アドレス検出機能を追加
  - TO欄・CC欄両方での誤送信防止
  - 警告メッセージの改善

- **v1.1.2** (2025年8月23日): メールアドレス解析改善版
  - 日本語名を含むメールアドレス形式に対応
  - Thunderbird 128.9.1での動作保証
  - メールアドレス解析ロジックの大幅改善

- **v1.1.1** (2025年8月23日): Thunderbird 142.0対応版
  - Thunderbird 142.0での動作保証
  - 最新バージョンでの互換性向上
  - バージョン範囲の明示（78.0-150.*）

- **v1.1.0** (2025年8月23日): 全環境対応版
  - 複数の送信検知方法による確実な動作
  - 強制的な送信停止機能
  - 即座の警告表示
  - 初期化保証機能

- **v1.0.9** (2025年8月23日): JavaScript無効対応版
  - JavaScript無効環境での動作改善
  - 複数回の通知表示

- **v1.0.0** (2025年1月27日): 初回リリース
  - 基本的な誤送信防止機能
  - TO欄の複数アドレス検出
  - 警告ダイアログの表示

詳細な更新履歴は [CHANGELOG.md](CHANGELOG.md) をご覧ください。

## 📄 ライセンス

このプロジェクトは [MIT License](LICENSE.txt) の下でライセンスされています。

```
MIT License

Copyright (c) 2025 AKIO OGAWA

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction...
```

## 👤 作成者情報

**AKIO OGAWA**
- 📧 Email: firecracker2100@yahoo.co.jp
- 🐙 GitHub: [@akioogawa](https://github.com/akioogawa)
- 🌐 Website: [GitHub Profile](https://github.com/akioogawa)

### 💡 開発動機

このアドオンは、実際のビジネス環境でのメール誤送信事故を防ぐために開発されました。特に日本のビジネス環境における適切なメール送信マナーの実現を目指しています。

### 🙏 謝辞

- Mozilla Thunderbird開発チーム
- WebExtension APIドキュメント
- コミュニティからのフィードバック

---

<div align="center">

**📧 安全で適切なメール送信のために 📧**

[⬆️ トップに戻る](#thunderbird-誤送信防止アドオン)

</div>

## 🌟 広報・普及戦略

### 📢 アドオンの普及方法

#### 1. **Mozilla Add-ons Store への公開**
- **AMO (Add-ons Mozilla) での公開**
  - 署名済みアドオンの作成
  - レビュープロセスの通過
  - 公式ストアでの配布

#### 2. **コミュニティでの共有**
- **GitHub での公開**
  - オープンソースとして公開
  - スター・フォークの促進
  - Issue・PRでの改善提案

- **技術ブログ・記事**
  - 開発経緯の共有
  - 技術的な詳細の解説
  - 使用事例の紹介

#### 3. **企業・組織での導入**
- **ビジネス環境での活用**
  - 社内メール運用の改善
  - プライバシー保護の強化
  - コンプライアンス対応

- **教育機関での活用**
  - 学生・教職員のメール運用
  - 情報漏洩防止の教育

### 🎯 ターゲットユーザー

#### **プライマリターゲット**
- **ビジネスパーソン**: 企業でのメール運用
- **教育関係者**: 学校・大学でのメール運用
- **個人ユーザー**: プライバシーを重視するユーザー

#### **セカンダリターゲット**
- **システム管理者**: 組織でのメール運用管理
- **開発者**: 同様のアドオン開発者
- **セキュリティ専門家**: プライバシー保護の専門家

### 📈 マーケティング戦略

#### **1. コンテンツマーケティング**
- **技術ブログ記事**
  - 「Thunderbirdでメール誤送信を防ぐ方法」
  - 「プライバシー保護のためのメール運用」
  - 「WebExtension開発の実践例」

- **動画コンテンツ**
  - アドオンのデモ動画
  - インストール・設定方法
  - 実際の使用シーン

#### **2. ソーシャルメディア**
- **Twitter/X**: 開発進捗・機能紹介
- **LinkedIn**: ビジネス用途での紹介
- **技術系フォーラム**: 開発者コミュニティでの共有

#### **3. プレスリリース**
- **IT系メディア**: 技術ニュースサイト
- **ビジネス系メディア**: 企業向け情報サイト
- **教育系メディア**: 学校・大学向け情報サイト

### 🤝 パートナーシップ

#### **1. オープンソースコミュニティ**
- **Mozilla コミュニティ**: 公式サポート
- **Thunderbird ユーザーグループ**: ユーザーコミュニティ
- **WebExtension 開発者**: 技術交流

#### **2. 企業パートナー**
- **メールサービスプロバイダー**: 連携機能の開発
- **セキュリティ企業**: セキュリティ機能の強化
- **教育機関**: 教育用途での活用

### 📊 成功指標

#### **短期目標（3ヶ月）**
- GitHub スター: 100+
- ダウンロード数: 1,000+
- ユーザーフィードバック: 50+

#### **中期目標（6ヶ月）**
- AMO での公開完了
- 企業導入: 10社+
- 技術記事: 5本+

#### **長期目標（1年）**
- 総ダウンロード数: 10,000+
- 企業導入: 100社+
- コミュニティ貢献者: 10人+

### 💡 今後の開発計画

#### **v1.2.0 予定機能**
- **設定画面の追加**: ユーザーカスタマイズ機能
- **統計機能**: 誤送信防止回数の記録
- **多言語対応**: 英語・中国語・韓国語

#### **v2.0.0 予定機能**
- **AI機能**: メール内容の自動チェック
- **クラウド連携**: 設定の同期機能
- **モバイル対応**: Thunderbird Mobile対応

---

**最終更新**: 2025年8月23日